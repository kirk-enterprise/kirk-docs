# 3.3 服务
服务是kubernetes的service概念，真正管理了容器实例。通过对服务进行操作可以实现容器规格的升级和降级，容器数量的扩容和缩容。用户也可以通过 **<应用名-服务名:服务端口>** 实现同一个区域同一个空间下服务的互相访问。服务类型分为「有状态服务」和「无状态服务」两种类型。

?> **有状态服务：**用于持久化存储数据，需要挂「存储卷」。只能单容器实例    
   **无状态服务：**不能持久化存储数据。支持多容器实例，允许做「服务伸缩」

## 3.3.1 属性说明
![](_figures/quick-start/create-app-5.png) 

### 基本配置

**1. 服务名：**服务一旦创建完成，「服务名」就不能被修改。会在服务配置内网访问时用到 **<应用名>-<服务名>:<端口号>**

!> **命名规则：**2-30位的小写字母、数字，开头为字母

**2. 服务类型：**分为「无状态」和「有状态」两种

**3. 镜像地址：**标明了该服务创建所基于的镜像类型和版本号，以及镜像所在的仓库地址。格式为**<仓库地址>/<空间名>/<镜像名称>:<版本号>**

**4. 容器规格**：提供6种容器规格

?> **1U1G：**单个容器配1个CPU核和1G内存资源  
   **1U2G：**单个容器配1个CPU核和2G内存资源  
   **2U2G：**单个容器配2个CPU核和2G内存资源  
   **2U4G：**单个容器配2个CPU核和4G内存资源    
   **4U8G：**单个容器配4个CPU核和8G内存资源    
   **8U16G：**单个容器配8个CPU核和16G内存资源

**5. 容器数量**：服务下的容器实例数。服务运行中时，也可以通过「服务伸缩」[详见3.3.4](#jump4) 进行容器数量的扩缩容，期间服务不中断

**6. 存储卷配置**：用于持久化存储数据。只有「有状态服务」能够添加存储卷

?> **存储名称：**下拉选择需要添加的存储卷(如果没有可用存储卷，也可以临时创建新的存储卷)    
   **读写方式：**服务对存储卷的操作权限，分读写和只读   
   **挂载路径：**存储卷映射到容器内部的路径  

### 网络配置 
**7. 网络配置**：配置服务网络，包括内网访问和外网访问的相关配置

?> **服务端口：**服务在内网的访问端口    
   **协议类型：**服务在内网的访问协议

**如何配置内网服务之间的互相访问？**    
内网通过dns实现服务的注册发现。服务的端口暴露方式是**应用名-服务名:服务端口**。[快速开始 - 服务的内网访问](quick-start/cluster-app.md)

**如何配置服务的外网暴露：**    
服务的外网暴露需要添加「负载均衡」到服务。外网暴露适用于跨空间、跨区域的服务互访，以及用户的服务访问。[快速开始 - 服务的外网访问](quick-start/cluster-app.md)

### 高级配置
**8. 配置文件**：实现容器内配置文件在平台上做维护的目的。将「配置中心」的配置集挂载到容器内某个文件路径。[详见3.10](user-guide/configmap.md)

?> **挂载路径：**容器内部文件路径，用于存放配置文件    
   **配置集名称：**选择需要挂载的配置集。一个配置集包含多个配置项，一个配置项是一个配置文件
   
**9. 环境变量**：配置服务的「环境变量」

> **加载方式**

?> **手动填写：**手动管理「变量值」  
   **配置中心：**通过「配置中心」的「配置项」管理「变量值」，[详见3.10.3](https://kirk-enterprise.github.io/kirk-docs/#/user-guide/configmap?id=_3103-环境变量中的应用)

**10. 运行目录**：容器启动后，在「运行目录」下执行命令

**11. 执行命令**：容器启动后的执行命令。如果填写了「执行命令」，dockerfile文件中定义的执行命令会被忽略
***

## 3.3.2 如何删除服务

![](_figures/user-guide/service-delete.gif)
***

## 3.3.3 如何启动/停止服务

![](_figures/user-guide/service-start-stop.gif)
***

## <span id="jump4">3.3.4 如何做服务伸缩</span>

「服务伸缩」是「无状态服务」对容器实例数量做扩容和缩容操作。

![](_figures/user-guide/service-scale.gif)
***

## 3.3.5 如何做服务升级

「服务升级」是对服务的「基本配置」和「高级配置」做修改，包括镜像版本、容器规格、存储卷配置、配置文件、环境变量、运行目录、执行命令。多容器实例时，「服务升级」是是在多个实例间做滚动升级(如果有n个实例，升级过程中保证有n-1个实例仍然提供服务)，因此升级过程中服务不会中断。

!> **注意：**服务升级会导致该服务下的容器日志和容器监控重置

![](_figures/user-guide/service-upgrade.gif)

***
## 3.3.6 如何做服务回滚

每次「服务升级」都会生成一个新的回滚版本，服务可以随时回滚到任意某个版本。

!> **注意：**服务回滚会导致该服务下的容器日志和容器监控重置

![](_figures/user-guide/service-rollback.gif)

***
## 3.3.7 服务下的日志和监控
平台提供了对一个服务下所有容器日志和容器监控的服务级聚类。在服务页面能够轻松筛选出该服务下的任何容器日志和监控。[详见3.12](user-guide/log-and-monitor.md)







